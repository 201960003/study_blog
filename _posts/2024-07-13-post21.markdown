---
layout: post
title:  canvas ì— mouseë¡œ ê·¸ë¦¼ ê·¸ë¦¬ê¸° (2)
date:   2024-07-13 +0900
categories: [HTML, Javascript]
---
## 1ï¸âƒ£ ì„  ì§€ìš°ê¸°
```html
<div class="controls">
        <label for="line-width">ì„  ë‘ê»˜: </label>
        <input type="range" id="line-width" min="1" max="10" value="1">
        <button id="eraser">ì§€ìš°ê°œ ì¼œê¸°</button>
        <button id="allclear">ëª¨ë‘ ì§€ìš°ê¸°</button>
    </div>
```

Javascript
  ```javascript

          // ì§€ìš°ê°œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('eraser').addEventListener('click', function() {
            isErasing = !isErasing;  // ì§€ìš°ê°œ ëª¨ë“œë¥¼ í† ê¸€
            if (isErasing) {
                this.textContent = 'ì§€ìš°ê°œ ë„ê¸°';
                // document.querySelectorAll('.color-button').forEach(btn => btn.classList.remove('selected'));  // ëª¨ë“  ìƒ‰ìƒ ë²„íŠ¼ ì„ íƒ í•´ì œ
            } else {
                this.textContent = 'ì§€ìš°ê°œ ì¼œê¸°';
            }
        });

        document.getElementById('allclear').addEventListener('click', function() {
            drawingContext.clearRect(0, 0, drawingCanvas.width, drawingCanvas.height);
        }); // ëª¨ë‘ ì§€ìš°ê¸°

        function handleMouseMove(event) {
            // ë§ˆìš°ìŠ¤ê°€ canvas íƒœê·¸ë‚´ì—ì„œ ì›€ì§ì˜€ì„ ë•Œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜

            if (!isDrawing) return;  // isDrawingì´ falseì¼ ë•ŒëŠ” returnìœ¼ë¡œ í•¨ìˆ˜ë¥¼ ì¢…ë£Œ

            // ë§ˆìš°ìŠ¤ê°€ ì›€ì§ì¼ ë•Œ isDrawingì´ trueì´ë©´ í˜„ì¬ ìœ„ì¹˜ë¥¼ ê°€ì ¸ì˜´
            const currentX = event.offsetX;
            const currentY = event.offsetY;

            drawingContext.lineWidth = lineWidth; // ì§€ì •í•œ ì„  ë‘ê»˜
            drawingContext.strokeStyle = strokeStyle; // ì§€ì •í•œ ì„  ìƒ‰ìƒ
            drawingContext.lineCap = lineCap; // ì§€ì •í•œ ì„  ëª¨ì–‘

            drawingContext.beginPath(); // contextì˜ ìƒˆë¡œìš´ ê²½ë¡œë¥¼ ì‹œì‘
            drawingContext.moveTo(lastX, lastY); // ë§ˆì§€ë§‰ ë§ˆìš°ìŠ¤ ìœ„ì¹˜
            drawingContext.lineTo(currentX, currentY); // moveToë¡œ ì§€ì •í•œ ì´ì „ ë§ˆìš°ìŠ¤ ìœ„ì¹˜ì—ì„œ í˜„ì¬ ë§ˆìš°ìŠ¤ ìœ„ì¹˜ê¹Œì§€ ì„  ê·¸ë¦¬ê¸°


            if (isErasing) {
                drawingContext.globalCompositeOperation = 'destination-out';
                drawingContext.stroke();
                drawingContext.globalCompositeOperation = 'source-over';
            } else {
                drawingContext.stroke();
            }
            
            // drawingContext.closePath(); // contextì˜ ê²½ë¡œë¥¼ ì¢…ë£Œ


            [lastX, lastY] = [currentX, currentY]; // í˜„ì¬ ìœ„ì¹˜ë¥¼ ì €ì¥
        }

  ```

    if (isErasing) ì¡°ê±´ì¼ ê²½ìš°
    drawingContext.globalCompositeOperation = 'destination-out';
    drawingContext.stroke();
    drawingContext.globalCompositeOperation = 'source-over'; ë¥¼ ì¶”ê°€í•˜ì—¬ ê·¸ë¦° ê²½ë¡œë§Œí¼ íˆ¬ëª…í•˜ê²Œ ë³€ê²½ë©ë‹ˆë‹¤.

    ê·¸ë¦¬ê³  ëª¨ë‘ì§€ìš°ê¸°ë¥¼ ëˆ„ë¥¼ ê²½ìš°ì—ëŠ” ìº”ë²„ìŠ¤ë¥¼ ìƒˆë¡œ ë‹¤ì‹œ ê·¸ë ¤ ë¦¬ì…‹í•©ë‹ˆë‹¤.

  <br><br>

## 2ï¸âƒ£ ì‚¬ì§„ ìœ„ì— ê·¸ë¦¼ ê·¸ë¦¬ê¸°

  HTML
  ```html 
    <button id="save">ì €ì¥</button>

    <div class="canvas-container">
        <canvas id="background-canvas" width="500" height="500"></canvas>
        <canvas id="drawing-canvas" width="500" height="500"></canvas>
    </div>
  ```

  Javascript
  ```javascript  
        var backgroundCanvas = document.getElementById("background-canvas"); // ê·¸ë¦¼ ë°°ê²½ canvas
        var drawingCanvas = document.getElementById("drawing-canvas"); // ì„  ê·¸ë¦¬ê¸° canvas

        var backgroundContext = backgroundCanvas.getContext("2d"); // backgroundCanvasì˜ context
        var drawingContext = drawingCanvas.getContext("2d"); // drawingContextì˜ context

        var image = new Image();
        window.onload = drawImage();

        function drawImage() {
            const canvasWidth = backgroundCanvas.width;
            const canvasHeight = backgroundCanvas.height;

            image.onload = () => {
                backgroundContext.drawImage(image, 0, 0, canvasWidth, canvasHeight);
            };
            image.onerror = () => {
                console.error('Error loading image:', image.src);
            };
            image.src = 'IMG_5445.jpg'; 
        }

            function saveCanvas() {
                var compositeCanvas = document.createElement('canvas'); // ê·¸ë¦¼ + ì„  ìº í¼ìŠ¤ í•©ì¹˜ê¸° ìœ„í•œ canvas ìƒì„±
                compositeCanvas.width = backgroundCanvas.width;
                compositeCanvas.height = backgroundCanvas.height;
                var compositeContext = compositeCanvas.getContext('2d'); //  compositeCanvasì˜ context ìƒì„±

                // ë°°ê²½ ìº”ë²„ìŠ¤ì™€ ë“œë¡œì‰ ìº”ë²„ìŠ¤ë¥¼ í•©ì¹¨
                compositeContext.drawImage(backgroundCanvas, 0, 0);
                compositeContext.drawImage(drawingCanvas, 0, 0);

                // í•©ì¹œ ìº”ë²„ìŠ¤ë¥¼ ì´ë¯¸ì§€ë¡œ ë³€í™˜í•˜ì—¬ ë‹¤ìš´ë¡œë“œ
                var dataURL = compositeCanvas.toDataURL('image/png');
                var link = document.createElement('a');
                link.href = dataURL;
                link.download = `${getCurrentDateTimeString()}.png`;
                link.click();
            }

            function getCurrentDateTimeString() {
                var today = new Date();
                var year = today.getFullYear();
                var month = String(today.getMonth() + 1).padStart(2, '0');
                var day = String(today.getDate()).padStart(2, '0');
                var hours = String(today.getHours()).padStart(2, '0');
                var minutes = String(today.getMinutes()).padStart(2, '0');
                var seconds = String(today.getSeconds()).padStart(2, '0');

                // Return formatted date and time string
                return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
            }

            document.getElementById('save').addEventListener('click', saveCanvas);
  ```
 ì´ë ‡ê²Œ ì„  ê·¸ë¦¬ëŠ” ìº”ë²„ìŠ¤ì™€ ì‚¬ì§„ ìº”ë²„ìŠ¤ë¥¼ ë”°ë¡œ í•œ ì´ìœ ëŠ” í•˜ë‚˜ë¡œ í–ˆì„ë•Œ ì´ë¯¸ì§€ê¹Œì§€ ì§€ì›Œì§€ëŠ” ë¬¸ì œë¡œ ì´ë¯¸ì§€ ìœ„ì— ì„ ì„ ê·¸ë¦´ ìˆ˜ ìˆê²Œ ìˆ˜ì •í•˜ì˜€ìŠµë‹ˆë‹¤.

 public í´ë” ì•ˆì— ìˆì–´ì•¼ì§€ ì‚¬ì§„ì„ ì¸ì‹í•´ì„œ ì›¹ í™”ë©´ì— ë³´ì—¬ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

 getCurrentDateTimeString() í•¨ìˆ˜ë¡œ ì´ë¯¸ì§€ë¥´ ì €ì¥í• ë•Œ í˜„ì¬ì‹œê°„ìœ¼ë¡œ íŒŒì¼ëª…ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

 <center>
  <img src="
  {{ site.baseurl }}_includes/img/post21/1.png" alt="ì²«ë²ˆì§¸ ì‚¬ì§„">
</center>

<br><br><br>

 ìµœì¢… í™”ë©´ ì´ë¯¸ì§€ëŠ” ì•„ë˜ì²˜ëŸ¼ ì‚¬ì§„ ìœ„ì— ìˆ˜ì •ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

<center>
  <img src="
  {{ site.baseurl }}_includes/img/post21/2.png" alt="ë‘ë²ˆì§¸ ì‚¬ì§„">
</center>

<br><br>

### ğŸ¤“ ì „ì²´ ì½”ë“œ
  ``` html
   <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ìº”ë²„ìŠ¤ì— ë§ˆìš°ìŠ¤ë¡œ ê·¸ë¦¼ ê·¸ë¦¬ê¸°</title>
        <!-- jquery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

        <style>
            /* canvas */
            .canvas-container {
                position: relative;
                width: 500px;
                height: 500px;
            }

            .canvas-container canvas {
                position: absolute;
                top: 0;
                left: 0;
                border: 1px solid #000;
                cursor: crosshair;
            }

            /* line-controll  */
            .controls {
                margin-bottom: 10px;
            }


            /*  color-picker  */
            .color-picker {
                display: flex;
                margin-bottom: 10px;
            }

            .color-button {
                position: relative;
                width: 30px;
                height: 30px;
                border-radius: 50%;
                margin: 5px;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .color-button span {
                display: none;
                color: white;
                font-size: 20px;
            }

            .color-button.selected span {
                display: block;
            }

            .black { background-color: black; color: white; }
            .red { background-color: red; }
            .orange { background-color: orange; }
            .yellow { background-color: yellow; }
            .green { background-color: green; }
            .blue { background-color: blue; }
            .indigo { background-color: indigo; }
            .violet { background-color: violet; }

        </style>

    </head>
    <body>
        <h1>ìº”ë²„ìŠ¤ì— ë§ˆìš°ìŠ¤ë¡œ ê·¸ë¦¼ ê·¸ë¦¬ê¸°</h1>
        <div class="controls">
            <label for="line-width">ì„  ë‘ê»˜: </label>
            <input type="range" id="line-width" min="1" max="10" value="1">
            <button id="eraser">ì§€ìš°ê°œ ì¼œê¸°</button>
            <button id="allclear">ëª¨ë‘ ì§€ìš°ê¸°</button>
        </div>
        
        <div class="color-picker">
            <div class="color-button black selected" data-color="black"><span>&#10003;</span></div>
            <div class="color-button red" data-color="red"><span>&#10003;</span></div>
            <div class="color-button orange" data-color="orange"><span>&#10003;</span></div>
            <div class="color-button yellow" data-color="yellow"><span>&#10003;</span></div>
            <div class="color-button green" data-color="green"><span>&#10003;</span></div>
            <div class="color-button blue" data-color="blue"><span>&#10003;</span></div>
            <div class="color-button indigo" data-color="indigo"><span>&#10003;</span></div>
            <div class="color-button violet" data-color="violet"><span>&#10003;</span></div>
        </div>
        
      
        <button id="save">ì €ì¥</button>

        <div class="canvas-container">
            <canvas id="background-canvas" width="500" height="500"></canvas>
            <canvas id="drawing-canvas" width="500" height="500"></canvas>
        </div>
        <script>

            // canvas part
            var backgroundCanvas = document.getElementById("background-canvas"); // ê·¸ë¦¼ ë°°ê²½ canvas
            var drawingCanvas = document.getElementById("drawing-canvas"); // ì„  ê·¸ë¦¬ê¸° canvas

            var backgroundContext = backgroundCanvas.getContext("2d"); // backgroundCanvasì˜ context
            var drawingContext = drawingCanvas.getContext("2d"); // drawingContextì˜ context

            var image = new Image();
            window.onload = drawImage();

            function drawImage() {
                const canvasWidth = backgroundCanvas.width;
                const canvasHeight = backgroundCanvas.height;

                image.onload = () => {
                    backgroundContext.drawImage(image, 0, 0, canvasWidth, canvasHeight);
                };
                image.onerror = () => {
                    console.error('Error loading image:', image.src);
                };
                image.src = 'IMG_5445.jpg'; 
            }

                function saveCanvas() {
                    var compositeCanvas = document.createElement('canvas'); // ê·¸ë¦¼ + ì„  ìº í¼ìŠ¤ í•©ì¹˜ê¸° ìœ„í•œ canvas ìƒì„±
                    compositeCanvas.width = backgroundCanvas.width;
                    compositeCanvas.height = backgroundCanvas.height;
                    var compositeContext = compositeCanvas.getContext('2d'); //  compositeCanvasì˜ context ìƒì„±

                    // ë°°ê²½ ìº”ë²„ìŠ¤ì™€ ë“œë¡œì‰ ìº”ë²„ìŠ¤ë¥¼ í•©ì¹¨
                    compositeContext.drawImage(backgroundCanvas, 0, 0);
                    compositeContext.drawImage(drawingCanvas, 0, 0);

                    // í•©ì¹œ ìº”ë²„ìŠ¤ë¥¼ ì´ë¯¸ì§€ë¡œ ë³€í™˜í•˜ì—¬ ë‹¤ìš´ë¡œë“œ
                    var dataURL = compositeCanvas.toDataURL('image/png');
                    var link = document.createElement('a');
                    link.href = dataURL;
                    link.download = `${getCurrentDateTimeString()}.png`;
                    link.click();
                }

                function getCurrentDateTimeString() {
                    var today = new Date();
                    var year = today.getFullYear();
                    var month = String(today.getMonth() + 1).padStart(2, '0');
                    var day = String(today.getDate()).padStart(2, '0');
                    var hours = String(today.getHours()).padStart(2, '0');
                    var minutes = String(today.getMinutes()).padStart(2, '0');
                    var seconds = String(today.getSeconds()).padStart(2, '0');

                    // Return formatted date and time string
                    return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
                }

                document.getElementById('save').addEventListener('click', saveCanvas);





            // line-controller part

            var lastX = 0; // ë§ˆì§€ë§‰ ë§ˆìš°ìŠ¤ ìœ„ì¹˜ x ê°’
            var lastY = 0; // ë§ˆì§€ë§‰ ë§ˆìš°ìŠ¤ ìœ„ì¹˜ y ê°’
            var isDrawing = false; // ê·¸ë¦¬ê¸° ìƒíƒœ, false : ì•ˆê·¸ë¦¬ê¸°
            var strokeStyle = 'black';  // ê¸°ë³¸ ì„  ìƒ‰ìƒ
            var lineWidth = 1; // ê¸°ë³¸ ì„  ë‘ê»˜
            var lineCap = "round";  // ê¸°ë³¸ ì„  ëª¨ì–‘
            var isErasing = false;  // ì§€ìš°ê°œ ëª¨ë“œ ì—¬ë¶€


            function handleMouseDown(event) {
                // ë§ˆìš°ìŠ¤ í´ë¦­í–ˆì„ ë•Œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
                isDrawing = true;
                [lastX, lastY] = [event.offsetX, event.offsetY];
                // í˜„ì¬ ë§ˆìš°ìŠ¤ ìœ„ì¹˜ì¸ [event.offsetX, event.offsetY] ë¥¼ ê°ê° lastX, lastY ì— ì €ì¥
            }


            function handleMouseMove(event) {
                // ë§ˆìš°ìŠ¤ê°€ canvas íƒœê·¸ë‚´ì—ì„œ ì›€ì§ì˜€ì„ ë•Œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜

                if (!isDrawing) return;  // isDrawingì´ falseì¼ ë•ŒëŠ” returnìœ¼ë¡œ í•¨ìˆ˜ë¥¼ ì¢…ë£Œ

                // ë§ˆìš°ìŠ¤ê°€ ì›€ì§ì¼ ë•Œ isDrawingì´ trueì´ë©´ í˜„ì¬ ìœ„ì¹˜ë¥¼ ê°€ì ¸ì˜´
                const currentX = event.offsetX;
                const currentY = event.offsetY;

                drawingContext.lineWidth = lineWidth; // ì§€ì •í•œ ì„  ë‘ê»˜
                drawingContext.strokeStyle = strokeStyle; // ì§€ì •í•œ ì„  ìƒ‰ìƒ
                drawingContext.lineCap = lineCap; // ì§€ì •í•œ ì„  ëª¨ì–‘

                drawingContext.beginPath(); // contextì˜ ìƒˆë¡œìš´ ê²½ë¡œë¥¼ ì‹œì‘
                drawingContext.moveTo(lastX, lastY); // ë§ˆì§€ë§‰ ë§ˆìš°ìŠ¤ ìœ„ì¹˜
                drawingContext.lineTo(currentX, currentY); // moveToë¡œ ì§€ì •í•œ ì´ì „ ë§ˆìš°ìŠ¤ ìœ„ì¹˜ì—ì„œ í˜„ì¬ ë§ˆìš°ìŠ¤ ìœ„ì¹˜ê¹Œì§€ ì„  ê·¸ë¦¬ê¸°


                if (isErasing) {
                    drawingContext.globalCompositeOperation = 'destination-out';
                    drawingContext.stroke();
                    drawingContext.globalCompositeOperation = 'source-over';
                } else {
                    drawingContext.stroke();
                }
                
                // drawingContext.closePath(); // contextì˜ ê²½ë¡œë¥¼ ì¢…ë£Œ


                [lastX, lastY] = [currentX, currentY]; // í˜„ì¬ ìœ„ì¹˜ë¥¼ ì €ì¥
            }

            function handleMouseUp() {
                // ë§ˆìš°ìŠ¤ í´ë¦­ í•´ì œí–ˆì„ ë•Œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
                isDrawing = false;
            }

            function handleMouseLeave() {
                // ë§ˆìš°ìŠ¤ê°€ canvas íƒœê·¸ë¥¼ ë²—ì–´ë‚¬ì„ ë•Œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
                isDrawing = false;
            }

            // ì„  ë‘ê»˜ ìŠ¬ë¼ì´ë” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('line-width').addEventListener('input', function() {
                lineWidth = this.value;
            });

            // ì§€ìš°ê°œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('eraser').addEventListener('click', function() {
                isErasing = !isErasing;  // ì§€ìš°ê°œ ëª¨ë“œë¥¼ í† ê¸€
                if (isErasing) {
                    this.textContent = 'ì§€ìš°ê°œ ë„ê¸°';
                    // document.querySelectorAll('.color-button').forEach(btn => btn.classList.remove('selected'));  // ëª¨ë“  ìƒ‰ìƒ ë²„íŠ¼ ì„ íƒ í•´ì œ
                } else {
                    this.textContent = 'ì§€ìš°ê°œ ì¼œê¸°';
                }
            });

            document.querySelectorAll('.color-button').forEach(button => {
                button.addEventListener('click', function() {
                    document.querySelectorAll('.color-button').forEach(btn => btn.classList.remove('selected')); // ê¸°ì¡´ì— ì²´í¬ë˜ì—ˆë˜ ìƒ‰ìƒì€ í•´ì œ
                    this.classList.add('selected'); // ì„ íƒí•œê±´ ì²´í¬í‘œì‹œ ë‚˜ì˜¤ê²Œ
                    strokeStyle = this.getAttribute('data-color'); // data-color ì†ì„±ê°’ìœ¼ë¡œ ì§€ì •í•œ ì„¹ìƒë³€ê²½
                    isErasing = false;  // ì§€ìš°ê°œ ëª¨ë“œë¥¼ í•´ì œ
                });
            });



            drawingCanvas.addEventListener('mousedown', handleMouseDown);
            drawingCanvas.addEventListener('mousemove', handleMouseMove);
            drawingCanvas.addEventListener('mouseup', handleMouseUp);
            drawingCanvas.addEventListener('mouseleave', handleMouseLeave);



            document.getElementById('allclear').addEventListener('click', function() {
                drawingContext.clearRect(0, 0, drawingCanvas.width, drawingCanvas.height);
            }); // ëª¨ë‘ ì§€ìš°ê¸°


        </script>
    </body>
    </html>

  ```


<br><br>

### ğŸ§ ì˜¤ëŠ˜ì˜ ì†Œê°ì€?
ìµœì¢…ì ìœ¼ë¡œ ì´ë¯¸ì§€ë¥¼ í”„ë¡œì íŠ¸ í´ë” ì•ˆì— public í´ë” ì•ˆì— ì§ì ‘ ì‚¬ì§„ì„ ë„£ì–´ì„œ ì‘ì—…ì„ í•œ ë¶€ë¶„ì´ ì•„ì‰½ê¸´ í•˜ì§€ë§Œ ê·¸ë˜ë„ ì´ ì½”ë“œ ì´í›„ì— í™•ì¥ì„±ì´ ì¢‹ë‹¤ê³  ìƒê°ì„ í•˜ê¸° ë–„ë¬¸ì— ì‚´ì§ ë¿Œë“¯... í•¨ì´ ìˆê¸´ í•©ë‹ˆë‹¤. ìµœê·¼ í”ŒëŸ¬í„°ë¡œ ì‘ì—…ì„ í•˜ë‹¤ê°€ ì´ë ‡ê²Œ ì›¹ìœ¼ë¥´ ì¡°ê¸ˆ ë‹¤ë£¨ë‹ˆê¹Œ ì‚´ì§ ì¬ë¯¸ìˆì–´ì§„ ê²ƒ ê°™ì•„ìš”. ìš”ì¦˜ ì•„ì§ ê°„ë‹¨í•œê²ƒë§Œ í•˜ëŠ”ë° ê·¸ë˜ë„ ì ì  ì–´ë ¤ìš´ ê²ƒë„ í•´ë‚´ëŠ” ì•„ê¸° ê°œë°œìê°€ ë˜ê³  ì‹¶ì–´ìš”!! ì—´ì‹¬íˆ ë¹ ìƒ¤ë¹ ìƒ¤

<br>